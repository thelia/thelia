<div class="form-container">

    {form name="thelia.admin.product.modification"}
    <form method="POST" action="{url path='/admin/products/save'}" {form_enctype form=$form} class="clearfix">

        {include
            file = "includes/inner-form-toolbar.html"
            hide_submit_buttons = false

            page_url  = "{url path='/admin/products/update' product_id=$ID}"
            close_url = "{url path='/admin/categories' category_id=$DEFAULT_CATEGORY}"
        }

        {* Be sure to get the product ID, even if the form could not be validated*}
        <input type="hidden" name="page" value="{$page}" />
        <input type="hidden" name="product_id" value="{$product_id}">
        <input type="hidden" name="current_tab" value="general">

        {form_hidden_fields form=$form}

        {form_field form=$form field='id'}
            <input type="hidden" name="{$name}" value="{$value}">
        {/form_field}

        {form_field form=$form field='success_url'}
            <input type="hidden" name="{$name}" value="{url path='/admin/categories' category_id=$DEFAULT_CATEGORY  page=$page}">
        {/form_field}

        {form_field form=$form field='locale'}
            <input type="hidden" name="{$name}" value="{$edit_language_locale}">
        {/form_field}

        {if $form_error}<div class="alert alert-danger">{$form_error_message}</div>{/if}

        <div class="row">
            <div class="col-md-8">
                {form_field form=$form field='ref'}
                    <div class="form-group {if $error}has-error{/if}">
                        <label for="{$label_attr.for}" class="control-label">
                            {$label} :
                        </label>
                        <div class="control-input">
                            <input type="text" id="{$label_attr.for}" name="{$name}" class="form-control" value="{$value}"{if $required} aria-required="true" required{/if}>
                        </div>
                    </div>
                {/form_field}

                {include file="includes/standard-description-form-fields.html"}
            </div>

            <div class="col-md-4">

                {form_field form=$form field='default_category'}
                    <div class="form-group {if $error}has-error{/if}" id="category_change">

                        <label for="{$label_attr.for}" class="control-label">
                            {$label} : <button type="button" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#category_changeModal">{intl l="(edit)"}</button>
                        </label>

                        <input type="hidden" id="{$label_attr.for}" name="{$name}" value="{$DEFAULT_CATEGORY}">
                        {if $DEFAULT_CATEGORY eq 0}
                            {$default_category_title={intl l="Top level"}}
                        {else}
                            {loop name="default_category-title" type="category" id=$DEFAULT_CATEGORY visible="*" backend_context="1"}
                                {$default_category_title=$TITLE}
                              {/loop}

                        {/if}
                        <p>{$default_category_title}</p>
                        <span class="help-block">{intl l='You can attach this product to more categories in the details tab.'}</span>
                     </div>
                {/form_field}

                {custom_render_form_field form=$form field='brand_id'}
                    <select {form_field_attributes form=$form field='brand_id'}>
                        <option value="0">{intl l="No brand"}</option>

                        {loop name="brand-list" type="brand" visible="*"}
                            <option value="{$ID}" {if $BRAND_ID == $ID}selected="selected"{/if}>{$TITLE}</option>
                        {/loop}
                    </select>
                {/custom_render_form_field}

                {form_field form=$form field='visible'}
                    <div class="form-group {if $error}has-error{/if}">
                        <label for="{$label_attr.for}" class="control-label">{intl l='Visibility'}</label>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" id="{$label_attr.for}" name="{$name}" value="1" {if $value != 0}checked="checked"{/if}>
                                {$label}
                            </label>
                        </div>
                    </div>
                {/form_field}
            </div>
        </div>

        {include
            file = "includes/inner-form-toolbar.html"
            hide_submit_buttons = false
            hide_flags = true

            page_url  = "{url path='/admin/products/update' product_id=$ID}"
            close_url = "{url path='/admin/categories' category_id=$DEFAULT_CATEGORY}"
        }

        <small>{intl l='Product created on %date_create. Last modification: %date_change' date_create="{format_date date=$CREATE_DATE}" date_change="{format_date date=$UPDATE_DATE}"}</small>

    </form>
    {/form}
</div>
{include file='includes/confirmation-modal.html' id="category_changeModal" title="{intl l="Select a category..."}" message=" "}