{extends file="admin-layout.tpl"}

{block name="page-title"}{intl l='Edit a tax'}{/block}

{block name="check-permissions"}admin.configuration.taxes.edit{/block}

{block name="main-content"}

<div class="taxes-rules edit-taxes-rules">

    <div id="wrapper" class="container">

        <ul class="breadcrumb">
            <li><a href="{url path='/admin/home'}">{intl l="Home"}</a></li>
            <li><a href="{url path='/admin/configuration'}">{intl l="Configuration"}</a></li>
            <li><a href="{url path='/admin/configuration/taxes_rules'}">{intl l="Taxes"}</a></li>
            <li>{intl l='Editing tax'}</li>
        </ul>

        {loop type="tax" name="tax" id=$tax_id backend_context="1" lang=$edit_language_id}

        <div class="row">
            <div class="col-md-12 general-block-decorator clearfix">

                <div class="form-container">

                {form name="thelia.admin.tax.modification"}

                <form method="POST" action="{url path="/admin/configuration/taxes/save"}" {form_enctype form=$form} >

                    {include
                        file = "includes/inner-form-toolbar.html"
                        hide_submit_buttons = false

                        page_url  = {url path="/admin/configuration/taxes/update/$tax_id"}
                        close_url = {url path="/admin/configuration/taxes_rules"}
                    }

                    {* Be sure to get the product ID, even if the form could not be validated *}
                    <input type="hidden" name="tax_id" value="{$ID}" />

                    {form_hidden_fields form=$form}

                    {form_field form=$form field='success_url'}
                        <input type="hidden" name="{$name}" value="{url path="/admin/configuration/taxes_rules"}" />
                    {/form_field}

                    {form_field form=$form field='locale'}
                        <input type="hidden" name="{$name}" value="{$edit_language_locale}" />
                    {/form_field}

                    {if $form_error}<div class="alert alert-danger">{$form_error_message}</div>{/if}

                    {form_field form=$form field='title'}
                    <div class="form-group {if $error}has-error{/if}">
                        <label for="{$label_attr.for}" class="control-label">{intl l=$label} : </label>
                        <input type="text" id="{$label_attr.for}" name="{$name}" required="required" title="{intl l='Title'}" placeholder="{intl l='Title'}" class="form-control" value="{if $error}{$value}{else}{if $IS_TRANSLATED == 1}{$TITLE}{/if}{/if}">
                    </div>
                    {/form_field}

                    {form_field form=$form field='description'}
                    <div class="form-group {if $error}has-error{/if}">
                        <label for="{$label_attr.for}" class="control-label">
                            {intl l=$label} :
                            <span class="label-help-block">{intl l="The detailed description."}</span>
                        </label>

                        <textarea name="{$name}" id="{$label_attr.for}" rows="10" class="form-control wysiwyg">{if $error}{$value}{else}{if $IS_TRANSLATED == 1}{$DESCRIPTION}{/if}{/if}</textarea>
                    </div>
                    {/form_field}

                    {form_field form=$form field='type'}
                        <div class="form-group {if $error}has-error{/if}">
                            <label for="{$label_attr.for}" class="control-label">
                                {intl l=$label} :
                            </label>

                            <div class="form-group">
                                <select name="{$name}" class="js-change-tax-type" data-toggle="selectpicker">
                                    {foreach $choices as $choice}
                                        <option value="{$choice->value}" {if $choice->value == $TYPE}selected="selected" {/if}>{$choice->label}</option>
                                    {/foreach}
                                </select>
                            </div>
                        </div>
                    {/form_field}

                    {form_tagged_fields form=$form tag='requirements'}
                        <div class="form-group {if $error}has-error{/if} js-tax-requirements" data-tax-type="{$data.tax_type}" {if $data.tax_type != $TYPE}style="display: none"{/if}>
                            <label for="{$label_attr.for}" class="control-label">
                                {intl l=$label} :
                            </label>
                            {if $formType == 'choice'}
                                <select name="{$name}">
                                    {foreach $choices as $choice}
                                        <option value="{$choice->value}">{$choice->label}</option>
                                    {/foreach}
                                </select>
                            {/if}
                            {if $formType == 'text'}
                                <input type="text" name="{$name}" value="">
                            {/if}
                        </div>
                    {/form_tagged_fields}

                    <div class="row">
                        <div class="col-md-12">
                            <div class="control-group">
                                <label>&nbsp;</label>
                                <div class="controls">
                                    <p>{intl l='Tax created on %date_create. Last modification: %date_change' date_create={format_date date=$CREATE_DATE} date_change={format_date date=$UPDATE_DATE}}</p>
                                </div>
                             </div>
                        </div>
                    </div>

                    </form>
                    {/form}
                </div>

            </div>
        </div>

        {/loop}

    </div>

{/block}

{block name="javascript-initialization"}

    {javascripts file='assets/js/bootstrap-select/bootstrap-select.js'}
        <script src='{$asset_url}'></script>
    {/javascripts}

    {javascripts file='assets/js/main.js'}
        <script src='{$asset_url}'></script>
    {/javascripts}

    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

    <script>
        $(function() {
            $('.js-change-tax-type').change(function(e){
                $('.js-tax-requirements').hide();
                $('.js-tax-requirements[data-tax-type="' + $(this).val() + '"]').show();
            });
        });

    </script>

{/block}