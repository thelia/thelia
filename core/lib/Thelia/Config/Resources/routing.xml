<?xml version="1.0" encoding="UTF-8" ?>

<config xmlns="http://thelia.net/schema/dic/config"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://thelia.net/schema/dic/config http://thelia.net/schema/dic/config/thelia-1.0.xsd">

    <parameters>
        <parameter key="router.request_context.class">Symfony\Component\Routing\RequestContext</parameter>
        <parameter key="router.null_generator.class">Thelia\Routing\NullUrlGenerator</parameter>
        <parameter key="router.dynamicRouter.class">Symfony\Cmf\Component\Routing\DynamicRouter</parameter>
        <parameter key="router.chainRouter.class">Symfony\Cmf\Component\Routing\ChainRouter</parameter>
        <parameter key="router.class">Symfony\Component\Routing\Router</parameter>
        <parameter key="router.xmlFileName">routing.xml</parameter>
    </parameters>

    <services>
        <service id="Thelia\Core\EventListener\ViewListener">
            <argument type="service" id="thelia.parser.resolver"/>
            <argument type="service" id="thelia.template_helper"/>
            <argument type="service" id="request_stack"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="router.chainRequest"/>
            <tag name="kernel.event_subscriber"/>
        </service>
        <service id="thelia.listener.view" alias="Thelia\Core\EventListener\ViewListener"/>

        <service id="controller.default" class="Thelia\Controller\DefaultController" public="true"/>

        <service id="thelia.admin.base_controller" class="Thelia\Admin\Controller\BaseAdminController">
       		<argument type="service" id="thelia.parser.resolver"/>
        </service>


        <service id="request.context" class="%router.request_context.class%" public="true" />


        <service id="router.fileLocator" class="Symfony\Component\Config\FileLocator" public="true">
            <argument>%thelia.core_dir%/Config/Resources/routing</argument>
        </service>

        <service id="router.xmlLoader" class="Symfony\Component\Routing\Loader\XmlFileLoader">
            <argument type="service" id="router.fileLocator"/>
        </service>

        <service id="router.module.fileLocator" class="Symfony\Component\Config\FileLocator">
            <argument>%thelia.module_dir%</argument>
        </service>

        <service id="router.module.xmlLoader" class="Symfony\Component\Routing\Loader\XmlFileLoader">
            <argument type="service" id="router.module.fileLocator"/>
        </service>

        <service id="router.admin" class="%router.class%" public="true">
            <argument type="service" id="router.xmlLoader"/>
            <argument>admin.xml</argument>
            <argument type="collection">
                <argument key="cache_dir">%kernel.cache_dir%</argument>
                <argument key="debug">%kernel.debug%</argument>
            </argument>
            <argument type="service" id="request.context"/>
            <tag name="router.register" priority="0"/>
        </service>

        <service id="router.rewrite" class="Thelia\Core\Routing\RewritingRouter" />


        <service id="thelia.loader.template_attributes" class="Thelia\Core\Routing\TemplateAttributeLoader" public="false">
          <tag name="routing.loader" priority="254"/>
        </service>
        <service id="thelia.loader.module_attributes" class="Thelia\Core\Routing\ModuleAttributeLoader" public="false">
          <tag name="routing.loader" priority="254"/>
        </service>
        <service id="thelia.loader.module_annotations" class="Thelia\Core\Routing\ModuleAnnotationLoader" public="false">
          <tag name="routing.loader" priority="253" />
        </service>
        <service id="thelia.loader.module_xml" class="Thelia\Core\Routing\ModuleXmlLoader" public="false">
          <argument>%env(APP_ENV)%</argument>
          <tag name="routing.loader" priority="252" />
        </service>

        <service id="router.chainRequest" class="%router.chainrouter.class%">
            <call method="setContext">
                <argument type="service" id="request.context"/>
            </call>
        </service>

        <service id="listener.router" class="Symfony\Component\HttpKernel\EventListener\RouterListener">
            <tag name="kernel.event_subscriber"/>
            <argument type="service" id="router.chainRequest"/>
            <argument type="service" id="request_stack"/>
        </service>
  </services>

</config>
