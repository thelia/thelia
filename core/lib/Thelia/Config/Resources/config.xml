<?xml version="1.0" encoding="UTF-8" ?>

<config xmlns="http://thelia.net/schema/dic/config"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://thelia.net/schema/dic/config http://thelia.net/schema/dic/config/thelia-1.0.xsd">

    <loops>
        <loop class="Thelia\Core\Template\Loop\Accessory" name="accessory"/>
        <loop class="Thelia\Core\Template\Loop\Address" name="address"/>
        <loop class="Thelia\Core\Template\Loop\Admin" name="admin"/>
        <loop class="Thelia\Core\Template\Loop\Area" name="area"/>
        <loop class="Thelia\Core\Template\Loop\AssociatedContent" name="associated_content"/>
        <loop class="Thelia\Core\Template\Loop\Attribute" name="attribute"/>
        <loop class="Thelia\Core\Template\Loop\AttributeAvailability" name="attribute_availability"/>
        <loop class="Thelia\Core\Template\Loop\AttributeCombination" name="attribute_combination"/>
        <loop class="Thelia\Core\Template\Loop\Auth" name="auth"/>
        <loop class="Thelia\Core\Template\Loop\Category" name="category"/>
        <loop class="Thelia\Core\Template\Loop\Content" name="content"/>
        <loop class="Thelia\Core\Template\Loop\Country" name="country"/>
        <loop class="Thelia\Core\Template\Loop\Currency" name="currency"/>
        <loop class="Thelia\Core\Template\Loop\Customer" name="customer"/>
        <loop class="Thelia\Core\Template\Loop\Feature" name="feature"/>
        <loop class="Thelia\Core\Template\Loop\FeatureAvailability" name="feature-availability"/>
        <loop class="Thelia\Core\Template\Loop\FeatureValue" name="feature_value"/>
        <loop class="Thelia\Core\Template\Loop\Folder" name="folder"/>
        <loop class="Thelia\Core\Template\Loop\FolderPath" name="folder-path"/>
        <loop class="Thelia\Core\Template\Loop\Module" name="module"/>
        <loop class="Thelia\Core\Template\Loop\Order" name="order"/>
        <loop class="Thelia\Core\Template\Loop\OrderAddress" name="order_address"/>
        <loop class="Thelia\Core\Template\Loop\OrderProduct" name="order_product"/>
        <loop class="Thelia\Core\Template\Loop\OrderProductAttributeCombination" name="order_product_attribute_combination"/>
        <loop class="Thelia\Core\Template\Loop\OrderStatus" name="order-status"/>
        <loop class="Thelia\Core\Template\Loop\CategoryPath" name="category-path"/>
        <loop class="Thelia\Core\Template\Loop\Payment" name="payment"/>
        <loop class="Thelia\Core\Template\Loop\Product" name="product"/>
        <loop class="Thelia\Core\Template\Loop\ProductSaleElements" name="product_sale_elements"/>
        <loop class="Thelia\Core\Template\Loop\Profile" name="profile"/>
        <loop class="Thelia\Core\Template\Loop\Resource" name="resource"/>
        <loop class="Thelia\Core\Template\Loop\Feed" name="feed"/>
        <loop class="Thelia\Core\Template\Loop\Title" name="title"/>
        <loop class="Thelia\Core\Template\Loop\Lang" name="lang"/>
        <loop class="Thelia\Core\Template\Loop\CategoryTree" name="category-tree"/>
        <loop class="Thelia\Core\Template\Loop\FolderTree" name="folder-tree"/>
        <loop class="Thelia\Core\Template\Loop\Cart" name="cart"/>
        <loop class="Thelia\Core\Template\Loop\Image" name="image"/>
        <loop class="Thelia\Core\Template\Loop\Document" name="document"/>
        <loop class="Thelia\Core\Template\Loop\Config" name="config"/>
        <loop class="Thelia\Core\Template\Loop\Coupon" name="coupon"/>
        <loop class="Thelia\Core\Template\Loop\Message" name="message"/>
        <loop class="Thelia\Core\Template\Loop\Delivery" name="delivery"/>
        <loop class="Thelia\Core\Template\Loop\Template" name="template"/> <!--  This is product templates ;-) -->
        <loop class="Thelia\Core\Template\Loop\Tax" name="tax"/>
        <loop class="Thelia\Core\Template\Loop\TaxRule" name="tax-rule"/>
        <loop class="Thelia\Core\Template\Loop\TaxRuleCountry" name="tax-rule-country"/>
    </loops>

    <forms>
        <!-- Forms for Frontend -->
        <form name="thelia.front.customer.login" class="Thelia\Form\CustomerLogin"/>
        <form name="thelia.front.customer.lostpassword" class="Thelia\Form\CustomerLostPasswordForm"/>
        <form name="thelia.front.customer.create" class="Thelia\Form\CustomerCreateForm"/>
        <form name="thelia.front.customer.profil.update" class="Thelia\Form\CustomerProfilUpdateForm"/>
        <form name="thelia.front.customer.password.update" class="Thelia\Form\CustomerPasswordUpdateForm"/>
        <form name="thelia.front.address.create" class="Thelia\Form\AddressCreateForm"/>
        <form name="thelia.front.address.update" class="Thelia\Form\AddressUpdateForm"/>
        <form name="thelia.front.contact" class="Thelia\Form\ContactForm"/>
        <form name="thelia.front.newsletter" class="Thelia\Form\NewsletterForm"/>

        <!--  Forms for Admin -->
        <form name="thelia.install.step3" class="Thelia\Form\InstallStep3Form"/>

        <form name="thelia.admin.login" class="Thelia\Form\AdminLogin"/>

        <form name="thelia.admin.customer.create" class="Thelia\Form\CustomerCreateForm"/>
        <form name="thelia.admin.customer.update" class="Thelia\Form\CustomerUpdateForm"/>

        <form name="thelia.admin.address.create" class="Thelia\Form\AddressCreateForm" />
        <form name="thelia.admin.address.update" class="Thelia\Form\AddressUpdateForm" />

        <form name="thelia.admin.category.creation" class="Thelia\Form\CategoryCreationForm"/>
        <form name="thelia.admin.category.modification" class="Thelia\Form\CategoryModificationForm"/>
        <form name="thelia.admin.category.image.modification" class="Thelia\Form\CategoryImageModification"/>
        <form name="thelia.admin.category.document.modification" class="Thelia\Form\CategoryDocumentModification"/>

        <form name="thelia.admin.product.creation" class="Thelia\Form\ProductCreationForm"/>
        <form name="thelia.admin.product.modification" class="Thelia\Form\ProductModificationForm"/>
        <form name="thelia.admin.product.details.modification" class="Thelia\Form\ProductDetailsModificationForm"/>
        <form name="thelia.admin.product.image.modification" class="Thelia\Form\ProductImageModification"/>
        <form name="thelia.admin.product.document.modification" class="Thelia\Form\ProductDocumentModification"/>

        <form name="thelia.admin.product_sale_element.update" class="Thelia\Form\ProductSaleElementUpdateForm"/>
        <form name="thelia.admin.product_default_sale_element.update" class="Thelia\Form\ProductDefaultSaleElementUpdateForm"/>
        <form name="thelia.admin.product_combination.build" class="Thelia\Form\ProductCombinationGenerationForm"/>


        <form name="thelia.admin.product.deletion" class="Thelia\Form\ProductModificationForm"/>

        <form name="thelia.admin.folder.creation" class="Thelia\Form\FolderCreationForm"/>
        <form name="thelia.admin.folder.modification" class="Thelia\Form\FolderModificationForm"/>
        <form name="thelia.admin.folder.image.modification" class="Thelia\Form\FolderImageModification"/>
        <form name="thelia.admin.folder.document.modification" class="Thelia\Form\FolderDocumentModification"/>

        <form name="thelia.admin.content.creation" class="Thelia\Form\ContentCreationForm"/>
        <form name="thelia.admin.content.modification" class="Thelia\Form\ContentModificationForm"/>
        <form name="thelia.admin.content.image.modification" class="Thelia\Form\ContentImageModification"/>
        <form name="thelia.admin.content.document.modification" class="Thelia\Form\ContentDocumentModification"/>

        <form name="thelia.cart.add" class="Thelia\Form\CartAdd"/>

        <form name="thelia.order.delivery" class="Thelia\Form\OrderDelivery"/>
        <form name="thelia.order.payment" class="Thelia\Form\OrderPayment"/>
        <form name="thelia.order.update.address" class="Thelia\Form\OrderUpdateAddress"/>

        <form name="thelia.order.coupon" class="Thelia\Form\CouponCode"/>

        <form name="thelia.admin.config.creation" class="Thelia\Form\ConfigCreationForm"/>
        <form name="thelia.admin.config.modification" class="Thelia\Form\ConfigModificationForm"/>

        <form name="thelia.admin.message.creation" class="Thelia\Form\MessageCreationForm"/>
        <form name="thelia.admin.message.modification" class="Thelia\Form\MessageModificationForm"/>

        <form name="thelia.admin.currency.creation" class="Thelia\Form\CurrencyCreationForm"/>
        <form name="thelia.admin.currency.modification" class="Thelia\Form\CurrencyModificationForm"/>

        <form name="thelia.admin.coupon.creation" class="Thelia\Form\CouponCreationForm"/>

        <form name="thelia.admin.attribute.creation" class="Thelia\Form\AttributeCreationForm"/>
        <form name="thelia.admin.attribute.modification" class="Thelia\Form\AttributeModificationForm"/>

        <form name="thelia.admin.feature.creation" class="Thelia\Form\FeatureCreationForm"/>
        <form name="thelia.admin.feature.modification" class="Thelia\Form\FeatureModificationForm"/>

        <form name="thelia.admin.attributeav.creation" class="Thelia\Form\AttributeAvCreationForm"/>

        <form name="thelia.admin.featureav.creation" class="Thelia\Form\FeatureAvCreationForm"/>

        <form name="thelia.admin.taxrule.modification" class="Thelia\Form\TaxRuleModificationForm"/>
        <form name="thelia.admin.taxrule.taxlistupdate" class="Thelia\Form\TaxRuleTaxListUpdateForm"/>
        <form name="thelia.admin.taxrule.add" class="Thelia\Form\TaxRuleCreationForm"/>

        <form name="thelia.admin.tax.modification" class="Thelia\Form\TaxModificationForm"/>
        <form name="thelia.admin.tax.taxlistupdate" class="Thelia\Form\TaxTaxListUpdateForm"/>
        <form name="thelia.admin.tax.add" class="Thelia\Form\TaxCreationForm"/>

        <form name="thelia.admin.profile.add" class="Thelia\Form\ProfileCreationForm"/>
        <form name="thelia.admin.profile.modification" class="Thelia\Form\ProfileModificationForm"/>
        <form name="thelia.admin.profile.resource-access.modification" class="Thelia\Form\ProfileUpdateResourceAccessForm"/>
        <form name="thelia.admin.profile.module-access.modification" class="Thelia\Form\ProfileUpdateModuleAccessForm"/>

        <form name="thelia.admin.administrator.add" class="Thelia\Form\AdministratorCreationForm"/>
        <form name="thelia.admin.administrator.update" class="Thelia\Form\AdministratorModificationForm"/>

        <form name="thelia.admin.mailing-system.update" class="Thelia\Form\MailingSystemModificationForm"/>

        <form name="thelia.admin.template.creation" class="Thelia\Form\TemplateCreationForm"/>
        <form name="thelia.admin.template.modification" class="Thelia\Form\TemplateModificationForm"/>

        <form name="thelia.admin.country.creation" class="Thelia\Form\CountryCreationForm"/>
        <form name="thelia.admin.country.modification" class="Thelia\Form\CountryModificationForm"/>

        <form name="thelia.admin.area.create" class="Thelia\Form\Area\AreaCreateForm"/>
        <form name="thelia.admin.area.modification" class="Thelia\Form\Area\AreaModificationForm"/>
        <form name="thelia.admin.area.country" class="Thelia\Form\Area\AreaCountryForm"/>
        <form name="thelia.admin.area.postage" class="Thelia\Form\Area\AreaPostageForm"/>

        <form name="thelia.shopping_zone_area" class="Thelia\Form\ShippingZone\ShippingZoneAddArea"/>
        <form name="thelia.shopping_zone_remove_area" class="Thelia\Form\ShippingZone\ShippingZoneRemoveArea"/>

        <form name="thelia.lang.update" class="Thelia\Form\Lang\LangUpdateForm"/>
        <form name="thelia.lang.create" class="Thelia\Form\Lang\LangCreateForm"/>
        <form name="thelia.lang.defaultBehavior" class="Thelia\Form\Lang\LangDefaultBehaviorForm"/>
        <form name="thelia.lang.url" class="Thelia\Form\Lang\LangUrlForm"/>
    </forms>


    <commands>
        <command class="Thelia\Command\ClearImageCache"/>
        <command class="Thelia\Command\CacheClear"/>
        <command class="Thelia\Command\Install"/>
        <command class="Thelia\Command\ModuleGenerateCommand"/>
        <command class="Thelia\Command\ModuleGenerateModelCommand"/>
        <command class="Thelia\Command\ModuleGenerateSqlCommand"/>
        <command class="Thelia\Command\ModuleActivateCommand"/>
        <command class="Thelia\Command\CreateAdminUser"/>
        <command class="Thelia\Command\ReloadDatabaseCommand"/>
        <command class="Thelia\Command\GenerateResources"/>
        <command class="Thelia\Command\AdminUpdatePasswordCommand"/>
    </commands>

    <services>

        <!--  URL maganement -->

        <service id="thelia.url.manager" class="Thelia\Tools\URL">
            <argument type="service" id="service_container" />
        </service>

        <service id="event_dispatcher" class="Symfony\Component\EventDispatcher\ContainerAwareEventDispatcher">
            <argument type="service" id="service_container" />
        </service>

		<!--
		A ControllerResolver that supports "a:b:c", "service:method" and class::method" notations,
		thus allowing the definition of controllers as service (see http://symfony.com/fr/doc/current/cookbook/controller/service.html)
		We use it here to inject the service container in the admin base controller.
		-->
        <service id="controller_resolver" class="Thelia\Core\Controller\ControllerResolver">
        	<argument type="service" id="service_container"/>
        </service>

		<!--  Translation and internationalisation -->

		<service id="thelia.translator" class="Thelia\Core\Translation\Translator">
			<argument type="service" id="service_container"/>
		</service>

		<!-- Security context for front and back office -->

		<service id="thelia.securityContext" class="Thelia\Core\Security\SecurityContext" scope="request">
            <argument type="service" id="request" />
		</service>

		<!--  Parser context -->

        <service id="thelia.parser.context" class="Thelia\Core\Template\ParserContext" scope="request">
        	<argument type="service" id="request" />
        </service>

		<!-- Parser configuration -->

        <service id="thelia.parser" class="Thelia\Core\Template\Smarty\SmartyParser" scope="request">
            <argument type="service" id="request" />
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="thelia.parser.context"/>
            <argument >false</argument> <!-- Template name, or false  -->
            <argument >%kernel.environment%</argument>
            <argument >%kernel.debug%</argument>
        </service>


		<!-- Smarty parser plugins -->

        <service id="smarty.plugin.assetic" class="Thelia\Core\Template\Smarty\Plugins\Assetic" >
            <tag name="thelia.parser.register_plugin"/>
            <argument>%kernel.environment%</argument>
        </service>

        <service id="smarty.plugin.theliasyntax" class="Thelia\Core\Template\Smarty\Plugins\TheliaSyntax" >
            <tag name="thelia.parser.register_plugin"/>
        </service>

        <service id="smarty.plugin.format" class="Thelia\Core\Template\Smarty\Plugins\Format" scope="request">
            <argument type="service" id="request"/>
            <tag name="thelia.parser.register_plugin"/>
        </service>

        <service id="smarty.plugin.thelialoop" class="Thelia\Core\Template\Smarty\Plugins\TheliaLoop" scope="request">
            <tag name="thelia.parser.register_plugin"/>
            <argument type="service" id="service_container" />
            <call method="setLoopList">
                <argument>%thelia.parser.loops%</argument>
            </call>
       </service>

        <service id="smarty.plugin.type" class="Thelia\Core\Template\Smarty\Plugins\Type" scope="request">
            <tag name="thelia.parser.register_plugin"/>
        </service>

        <service id="smart.plugin.form" class="Thelia\Core\Template\Smarty\Plugins\Form" scope="request">
            <tag name="thelia.parser.register_plugin"/>

            <argument type="service" id="request"/>
            <argument type="service" id="thelia.parser.context"/>

            <call method="setFormDefinition">
                <argument>%thelia.parser.forms%</argument>
            </call>
        </service>

        <service id="smarty.plugin.translation" class="Thelia\Core\Template\Smarty\Plugins\Translation" >
            <tag name="thelia.parser.register_plugin"/>
            <argument type="service" id="thelia.translator" />
        </service>

        <service id="smarty.plugin.module" class="Thelia\Core\Template\Smarty\Plugins\Module" >
            <tag name="thelia.parser.register_plugin"/>
        </service>

        <service id="smarty.url.module" class="Thelia\Core\Template\Smarty\Plugins\UrlGenerator" scope="request">
            <tag name="thelia.parser.register_plugin"/>
            <argument type="service" id="request"/>
        </service>

        <service id="smarty.plugin.security" class="Thelia\Core\Template\Smarty\Plugins\Security" scope="request">
            <tag name="thelia.parser.register_plugin"/>
            <argument type="service" id="request" />
            <argument type="service" id="thelia.securityContext" />
        </service>

        <service id="smarty.plugin.dataAccess" class="Thelia\Core\Template\Smarty\Plugins\DataAccessFunctions" scope="request">
            <tag name="thelia.parser.register_plugin"/>
            <argument type="service" id="request" />
            <argument type="service" id="thelia.securityContext" />
            <argument type="service" id="thelia.parser.context"/>
            <argument type="service" id="event_dispatcher"/>
        </service>

        <service id="smarty.plugin.adminUtilities" class="Thelia\Core\Template\Smarty\Plugins\AdminUtilities" scope="request">
            <tag name="thelia.parser.register_plugin"/>
            <argument type="service" id="thelia.securityContext" />
        </service>

        <service id="smarty.plugin.flashMessage" class="Thelia\Core\Template\Smarty\Plugins\FlashMessage" scope="request">
            <tag name="thelia.parser.register_plugin"/>
            <argument type="service" id="request" />
        </service>


        <service id="http_kernel" class="Thelia\Core\TheliaHttpKernel">
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="service_container" />
            <argument type="service" id="controller_resolver" />
        </service>

        <service id="request" scope="request" synthetic="true" />

        <service id="service_container" synthetic="true" />

        <service id="kernel" synthetic="true" />

        <!-- Coupon module -->
        <service id="thelia.adapter" class="Thelia\Coupon\BaseFacade">
            <argument type="service" id="service_container" />
        </service>
        <service id="thelia.coupon.manager" class="Thelia\Coupon\CouponManager">
            <argument type="service" id="service_container" />
        </service>
        <service id="thelia.coupon.factory" class="Thelia\Coupon\CouponFactory">
            <argument type="service" id="service_container" />
        </service>

        <service id="thelia.coupon.type.remove_x_amount" class="Thelia\Coupon\Type\RemoveXAmountManager">
            <argument type="service" id="thelia.adapter" />
            <tag name="thelia.coupon.addCoupon"/>
        </service>
        <service id="thelia.coupon.type.remove_x_percent" class="Thelia\Coupon\Type\RemoveXPercentManager">
            <argument type="service" id="thelia.adapter" />
            <tag name="thelia.coupon.addCoupon"/>
        </service>


        <!-- Condition module -->
        <service id="thelia.condition.factory" class="Thelia\Condition\ConditionFactory">
            <argument type="service" id="service_container" />
        </service>
        <service id="thelia.condition.validator" class="Thelia\Condition\ConditionEvaluator">
        </service>
        <service id="thelia.condition.match_for_everyone" class="Thelia\Condition\Implementation\MatchForEveryoneManager">
            <argument type="service" id="thelia.adapter" />
            <tag name="thelia.coupon.addCondition"/>
        </service>
        <service id="thelia.condition.match_for_x_articles" class="Thelia\Condition\Implementation\MatchForXArticlesManager">
            <argument type="service" id="thelia.adapter" />
            <tag name="thelia.coupon.addCondition"/>
        </service>
        <service id="thelia.condition.match_for_total_amount" class="Thelia\Condition\Implementation\MatchForTotalAmountManager">
            <argument type="service" id="thelia.adapter" />
            <tag name="thelia.coupon.addCondition"/>
        </service>

        <service id="mailer" class="Thelia\Mailer\MailerFactory">
            <argument type="service" id="event_dispatcher"/>
        </service>


    </services>

</config>
